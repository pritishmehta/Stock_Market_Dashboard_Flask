<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Loading overlay -->
    <div class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Fetching data</div>
    </div>
    
    <!-- Header with search bar -->
    <header>
        <h1 class="dashboard-title">Stock Market Dashboard</h1>

    </header>
    
    <!-- Navigation tabs -->
    <nav>
        <ul class="tabs">
            <li class="tab-link active" data-tab="home-section"><a href= "/" style="text-decoration: none; color: inherit; display: block;">Market Overview</a></li>
            <li class="tab-link" data-tab="stock-section">Stock Details & Technical Analysis</li>
            <li class="tab-link"><a href= "/market_movers" style="text-decoration: none; color: inherit; display: block;">Market Movers</a></li>
            <li class="tab-link"><a href="/sectors" style="text-decoration: none; color: inherit; display: block;">Sector Analysis</a></li>
            <li class="tab-link"><a href="/indes" style="text-decoration: none; color: inherit; display: block;">Economic Indicators</a></li>

        </ul>
    </nav>
    
    <!-- Main container -->
    <div class="container">
        <!-- Market Overview Section -->
        <section id="home-section" class="section active">
            <h2>Market Overview</h2>
            <p class="date-time">Last updated: <span id="last-updated">{{ last_updated }}</span></p>
            <h2>US Stock Indexes</h2>
            <!-- Top Row: 4 Cards -->
            <div class="index-grid-top">
                <!-- S&P 500 -->
                {% if 'S&P 500' in indices_data %}
                <div class="index-card glow" data-index="sp500">
                    <div class="index-name">S&P 500</div>
                    <div class="index-value count-animation">{{ indices_data['S&P 500']['price'] }}</div>
                    <div class="index-change {% if indices_data['S&P 500']['pct_change'] > 0 %}positive{% else %}negative{% endif %}">
                        {{ indices_data['S&P 500']['pct_change'] }}% ({{ indices_data['S&P 500']['point_change']|float|round(2)|string }})
                    </div>
                </div>
                {% else %}
                <div class="index-card glow">S&P 500: Data unavailable</div>
                {% endif %}
                
                <!-- Dow Jones -->
                {% if 'Dow Jones' in indices_data %}
                <div class="index-card glow" data-index="dow">
                    <div class="index-name">Dow Jones</div>
                    <div class="index-value count-animation">{{ indices_data['Dow Jones']['price'] }}</div>
                    <div class="index-change {% if indices_data['Dow Jones']['pct_change'] > 0 %}positive{% else %}negative{% endif %}">
                        {{ indices_data['Dow Jones']['pct_change'] }}% ({{ indices_data['Dow Jones']['point_change']|float|round(2)|string }})
                    </div>
                </div>
                {% else %}
                <div class="index-card glow">Dow Jones: Data unavailable</div>
                {% endif %}
                
                <!-- Nasdaq -->
                {% if 'NASDAQ' in indices_data %}
                <div class="index-card glow" data-index="nasdaq">
                    <div class="index-name">Nasdaq</div>
                    <div class="index-value count-animation">{{ indices_data['NASDAQ']['price'] }}</div>
                    <div class="index-change {% if indices_data['NASDAQ']['pct_change'] > 0 %}positive{% else %}negative{% endif %}">
                        {{ indices_data['NASDAQ']['pct_change'] }}% ({{ indices_data['NASDAQ']['point_change']|float|round(2)|string }})
                    </div>
                </div>
                {% else %}
                <div class="index-card glow">Nasdaq: Data unavailable</div>
                {% endif %}
                
                <!-- Russell 2000 -->
                {% if 'Russell 2000' in indices_data %}
                <div class="index-card glow" data-index="russell">
                    <div class="index-name">Russell 2000</div>
                    <div class="index-value count-animation">{{ indices_data['Russell 2000']['price'] }}</div>
                    <div class="index-change {% if indices_data['Russell 2000']['pct_change'] > 0 %}positive{% else %}negative{% endif %}">
                        {{ indices_data['Russell 2000']['pct_change'] }}% ({{ indices_data['Russell 2000']['point_change']|float|round(2)|string }})
                    </div>
                </div>
                {% else %}
                <div class="index-card glow">Russell 2000: Data unavailable</div>
                {% endif %}
            </div>
            <h2>Indian Stock Indexes</h2>
            <!-- Bottom Row: 2 Cards -->
            <div class="index-grid-bottom">
                <!-- Nifty 50 -->
                {% if 'Nifty 50' in indices_data %}
                <div class="index-card glow" data-index="nsei">
                    <div class="index-name">Nifty 50</div>
                    <div class="index-value count-animation">{{ indices_data['Nifty 50']['price'] }}</div>
                    <div class="index-change {% if indices_data['Nifty 50']['pct_change'] > 0 %}positive{% else %}negative{% endif %}">
                        {{ indices_data['Nifty 50']['pct_change'] }}% ({{ indices_data['Nifty 50']['point_change']|float|round(2)|string }})
                    </div>
                </div>
                {% else %}
                <div class="index-card glow">Nifty 50: Data unavailable</div>
                {% endif %}
                
                <!-- Sensex -->
                {% if 'Sensex' in indices_data %}
                <div class="index-card glow" data-index="nikkei">
                    <div class="index-name">Sensex</div>
                    <div class="index-value count-animation">{{ indices_data['Sensex']['price'] }}</div>
                    <div class="index-change {% if indices_data['Sensex']['pct_change'] > 0 %}positive{% else %}negative{% endif %}">
                        {{ indices_data['Sensex']['pct_change'] }}% ({{ indices_data['Sensex']['point_change']|float|round(2)|string }})
                    </div>
                </div>
                {% else %}
                <div class="index-card glow">Sensex: Data unavailable</div>
                {% endif %}
            </div>
            
            <div class="card">
                <div class="card-title">
                    <h3>Market Summary</h3>
                </div>
                <!-- News Section Added Here -->
                <div class="news-section">
                    <h4 style="margin-bottom: 1rem; color: var(--text-secondary);">Latest Market News</h4>
                    {% if news_data %}
                        {% for news in news_data %}
                        <div class="news-item {{ news.sentiment }}">
                            <div class="news-title">
                                <a href="{{ news.url }}" target="_blank" class="news-link">{{ news.title }}</a>
                            </div>
                            <p>{{ news.text }}</p>
                            <div class="news-source">{{ news.published }} • {{ news.source }}</div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: var(--text-tertiary);">No news available at the moment.</p>
                    {% endif %}
                </div>
            </div>
        </section>
        
        <!-- Stock Details Section -->
        <section id="stock-section" class="section">
            <div id="no-stock-selected" class="card">
                <p>Please use the search bar to find a stock.</p>
            </div>
            <div class="search-container">
                <input type="text" placeholder="Search for a stock (e.g., AAPL, MSFT, GOOGL)" id="stock-search">
                <button id="search-button">Search</button>
            </div>
            
            <div id="stock-content" style="display: none;">
                <div class="stock-header">
                    <h2 class="stock-name">Apple Inc.</h2>
                    <span class="stock-ticker">AAPL</span>
                </div>
                
                <div class="stock-details">
                    <!-- Stock Price and Info -->
                    <div class="card">
                        <div class="stock-price count-animation">$185.92</div>
                        <div class="index-change positive">+2.45 (+1.32%)</div>
                        
                        <div class="placeholder-chart">
                            <svg viewBox="0 0 400 200">
                                <!-- Placeholder line chart with gradient -->
                                <defs>
                                    <linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="var(--success)" stop-opacity="0.5" />
                                        <stop offset="100%" stop-color="var(--success)" stop-opacity="0" />
                                    </linearGradient>
                                </defs>
                                
                                <!-- Area under the line -->
                                <path class="animated-area" d="M 0,120 L 50,100 L 100,110 L 150,95 L 200,85 L 250,75 L 300,60 L 350,50 L 400,45 L 400,180 L 0,180 Z" fill="url(#areaGradient)" />
                                
                                <!-- Main line -->
                                <path class="animated-line" d="M 0,120 L 50,100 L 100,110 L 150,95 L 200,85 L 250,75 L 300,60 L 350,50 L 400,45" stroke="var(--success)" stroke-width="2" fill="none" />
                                
                                <!-- X-axis -->
                                <line x1="0" y1="180" x2="400" y2="180" stroke="var(--border)" />
                                <!-- Y-axis -->
                                <line x1="0" y1="180" x2="0" y2="0" stroke="var(--border)" />
                            </svg>
                        </div>
                        
                        <div class="data-row">
                            <span class="data-label">Open</span>
                            <span class="data-value">$183.47</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Previous Close</span>
                            <span class="data-value">$183.47</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Day Range</span>
                            <span class="data-value">$182.15 - $186.34</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">52 Week Range</span>
                            <span class="data-value">$155.98 - $220.30</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Volume</span>
                            <span class="data-value">65.3M</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Market Cap</span>
                            <span class="data-value">$2.89T</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">P/E Ratio</span>
                            <span class="data-value">30.45</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">EPS</span>
                            <span class="data-value">$6.10</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Dividend Yield</span>
                            <span class="data-value">0.51%</span>
                        </div>
                    </div>
                    
                    <!-- Stock News -->
                    <div class="card">
                        <div class="card-title">
                            <h3>Latest News</h3>
                        </div>
                        
                        <div class="news-item positive">
                            <div class="news-title">Apple Announces New M3 Pro iPads With Enhanced AI Capabilities</div>
                            <p>Apple has unveiled its latest iPads featuring the new M3 Pro chip which significantly boosts AI processing.</p>
                            <div class="news-source">9 hours ago • TechCrunch</div>
                        </div>
                        
                        <div class="news-item neutral">
                            <div class="news-title">Apple Reportedly Working on Foldable iPhone for 2026</div>
                            <p>According to industry sources, Apple is developing a foldable iPhone with plans for a 2026 release.</p>
                            <div class="news-source">1 day ago • Bloomberg</div>
                        </div>
                        
                        <div class="news-item negative">
                            <div class="news-title">European Commission Launches New Antitrust Investigation Into Apple</div>
                            <p>The EC is looking into Apple's App Store practices regarding third-party app developers.</p>
                            <div class="news-source">2 days ago • Reuters</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Market Movers Section -->
        
        
        <!-- Sector Performance Section -->
        <section id="sectors-section" class="section">
            <h2>Sector Performance</h2>
            
            <div class="tab-selector">
                <div class="tab-item active" data-index="sp500">S&P 500</div>
                <div class="tab-item" data-index="dow">Dow Jones</div>
                <div class="tab-item" data-index="nasdaq">Nasdaq</div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <h3>Sector Overview</h3>
                </div>
                
                <div class="placeholder-chart">
                    <svg viewBox="0 0 400 200">
                        <!-- Placeholder bar chart with animation -->
                        <g class="animated-bar">
                            <rect x="10" y="40" width="30" height="140" fill="var(--success)" />
                            <rect x="50" y="90" width="30" height="90" fill="var(--success)" />
                            <rect x="90" y="110" width="30" height="70" fill="var(--success)" />
                            <rect x="130" y="130" width="30" height="50" fill="var(--success)" />
                            <rect x="170" y="150" width="30" height="30" fill="var(--danger)" />
                            <rect x="210" y="160" width="30" height="20" fill="var(--danger)" />
                            <rect x="250" y="140" width="30" height="40" fill="var(--danger)" />
                            <rect x="290" y="100" width="30" height="80" fill="var(--success)" />
                            <rect x="330" y="170" width="30" height="10" fill="var(--danger)" />
                            <rect x="370" y="80" width="30" height="100" fill="var(--success)" />
                        </g>
                        
                        <!-- X-axis labels -->
                        <text x="25" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Tech</text>
                        <text x="65" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Health</text>
                        <text x="105" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Fin</text>
                        <text x="145" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Cons</text>
                        <text x="185" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Energy</text>
                        <text x="225" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Utils</text>
                        <text x="265" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Real</text>
                        <text x="305" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Ind</text>
                        <text x="345" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Mat</text>
                        <text x="385" y="195" fill="var(--text-tertiary)" font-size="10" text-anchor="middle">Comm</text>
                        
                        <!-- X-axis -->
                        <line x1="0" y1="180" x2="400" y2="180" stroke="var(--border)" />
                    </svg>
                </div>
            </div>
            
            <div class="sector-grid">
                <div class="sector-card">
                    <div class="sector-name">Technology</div>
                    <div class="index-change positive">+1.75%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,70 L 20,60 L 40,50 L 60,40 L 80,30 L 100,20 L 120,25 L 140,15 L 160,10 L 180,5 L 200,10" stroke="var(--primary)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Healthcare</div>
                    <div class="index-change positive">+0.53%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,60 L 20,50 L 40,55 L 60,50 L 80,45 L 100,40 L 120,45 L 140,50 L 160,45 L 180,40 L 200,35" stroke="var(--primary)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Financials</div>
                    <div class="index-change positive">+0.32%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,50 L 20,55 L 40,50 L 60,45 L 80,50 L 100,45 L 120,40 L 140,45 L 160,50 L 180,48 L 200,46" stroke="var(--primary)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Consumer Discretionary</div>
                    <div class="index-change negative">-0.24%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,45 L 20,50 L 40,55 L 60,60 L 80,55 L 100,60 L 120,65 L 140,60 L 160,65 L 180,60 L 200,55" stroke="var(--danger)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Energy</div>
                    <div class="index-change negative">-1.34%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,40 L 20,45 L 40,50 L 60,55 L 80,60 L 100,65 L 120,70 L 140,65 L 160,70 L 180,75 L 200,80" stroke="var(--danger)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Industrials</div>
                    <div class="index-change positive">+0.85%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,55 L 20,50 L 40,45 L 60,40 L 80,45 L 100,40 L 120,35 L 140,30 L 160,35 L 180,30 L 200,25" stroke="var(--primary)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Materials</div>
                    <div class="index-change positive">+0.27%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,50 L 20,49 L 40,48 L 60,47 L 80,46 L 100,45 L 120,44 L 140,43 L 160,42 L 180,41 L 200,40" stroke="var(--primary)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Real Estate</div>
                    <div class="index-change negative">-0.18%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,45 L 20,46 L 40,47 L 60,48 L 80,49 L 100,50 L 120,51 L 140,52 L 160,53 L 180,54 L 200,55" stroke="var(--danger)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Utilities</div>
                    <div class="index-change negative">-0.43%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,45 L 20,48 L 40,51 L 60,54 L 80,51 L 100,54 L 120,57 L 140,60 L 160,57 L 180,60 L 200,63" stroke="var(--danger)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="sector-card">
                    <div class="sector-name">Communication Services</div>
                    <div class="index-change positive">+1.12%</div>
                    <div class="placeholder-chart" style="height: 100px;">
                        <svg viewBox="0 0 200 100">
                            <path class="animated-line" d="M 0,60 L 20,55 L 40,50 L 60,45 L 80,40 L 100,35 L 120,30 L 140,25 L 160,30 L 180,25 L 200,20" stroke="var(--primary)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Economic Indicators Section -->
        <section id="indicators-section" class="section">
            <h2>Economic Indicators</h2>
            
            <div class="economic-indicators-grid">
                <div class="indicator-card">
                    <div class="indicator-name">Inflation Rate (CPI)</div>
                    <div class="indicator-value count-animation">2.4%</div>
                    <div class="index-change negative">-0.1% from previous month</div>
                    <div class="placeholder-chart" style="height: 150px;">
                        <svg viewBox="0 0 300 150">
                            <path class="animated-line" d="M 0,50 L 30,60 L 60,70 L 90,65 L 120,75 L 150,80 L 180,70 L 210,60 L 240,55 L 270,50 L 300,40" stroke="var(--primary)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">Unemployment Rate</div>
                    <div class="indicator-value count-animation">3.9%</div>
                    <div class="index-change positive">-0.1% from previous month</div>
                    <div class="placeholder-chart" style="height: 150px;">
                        <svg viewBox="0 0 300 150">
                            <path class="animated-line" d="M 0,50 L 30,55 L 60,60 L 90,65 L 120,60 L 150,55 L 180,50 L 210,45 L 240,40 L 270,35 L 300,30" stroke="var(--success)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">GDP Growth (Quarterly)</div>
                    <div class="indicator-value count-animation">2.1%</div>
                    <div class="index-change positive">+0.3% from previous quarter</div>
                    <div class="placeholder-chart" style="height: 150px;">
                        <svg viewBox="0 0 300 150">
                            <path class="animated-line" d="M 0,80 L 30,70 L 60,75 L 90,70 L 120,65 L 150,60 L 180,50 L 210,55 L 240,45 L 270,40 L 300,30" stroke="var(--success)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">Fed Funds Rate</div>
                    <div class="indicator-value count-animation">4.5%</div>
                    <div class="index-change neutral">Unchanged from previous month</div>
                    <div class="placeholder-chart" style="height: 150px;">
                        <svg viewBox="0 0 300 150">
                            <path class="animated-line" d="M 0,30 L 30,30 L 60,30 L 90,30 L 120,30 L 150,30 L 180,30 L 210,30 L 240,30 L 270,30 L 300,30" stroke="var(--neutral)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">10-Year Treasury Yield</div>
                    <div class="indicator-value count-animation">3.82%</div>
                    <div class="index-change negative">-0.05% from previous day</div>
                    <div class="placeholder-chart" style="height: 150px;">
                        <svg viewBox="0 0 300 150">
                            <path class="animated-line" d="M 0,40 L 30,45 L 60,50 L 90,45 L 120,50 L 150,55 L 180,50 L 210,55 L 240,60 L 270,55 L 300,65" stroke="var(--danger)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">Consumer Sentiment Index</div>
                    <div class="indicator-value count-animation">78.3</div>
                    <div class="index-change positive">+2.1 from previous month</div>
                    <div class="placeholder-chart" style="height: 150px;">
                        <svg viewBox="0 0 300 150">
                            <path class="animated-line" d="M 0,80 L 30,75 L 60,70 L 90,75 L 120,65 L 150,60 L 180,55 L 210,50 L 240,45 L 270,40 L 300,35" stroke="var(--success)" stroke-width="2" fill="none" />
                        </svg>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Technical Analysis Section -->
        <section id="analysis-section" class="section">
            <h2>Technical Analysis</h2>
            
            <div id="no-stock-analysis" class="card">
                <p>Please use the search bar to find a stock for technical analysis.</p>
            </div>
            
            <div id="analysis-content" style="display: none;">
                <div class="stock-header">
                    <h2 class="stock-name">Apple Inc.</h2>
                    <span class="stock-ticker">AAPL</span>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <h3>Technical Indicators</h3>
                    </div>
                    
                    <div class="placeholder-chart">
                        <svg viewBox="0 0 400 200">
                            <!-- Candlestick representation -->
                            <g class="animated-bar">
                                <line x1="20" y1="70" x2="20" y2="90" stroke="#4f46e5" stroke-width="4" />
                                <rect x="18" y="90" width="4" height="40" fill="#4f46e5" />
                                <line x1="60" y1="60" x2="60" y2="80" stroke="#4f46e5" stroke-width="4" />
                                <rect x="58" y="80" width="4" height="30" fill="#4f46e5" />
                                <line x1="100" y1="70" x2="100" y2="100" stroke="#ef4444" stroke-width="4" />
                                <rect x="98" y="50" width="4" height="20" fill="#ef4444" />
                                <line x1="140" y1="40" x2="140" y2="60" stroke="#4f46e5" stroke-width="4" />
                                <rect x="138" y="60" width="4" height="20" fill="#4f46e5" />
                                <line x1="180" y1="30" x2="180" y2="50" stroke="#4f46e5" stroke-width="4" />
                                <rect x="178" y="50" width="4" height="30" fill="#4f46e5" />
                                <line x1="220" y1="50" x2="220" y2="70" stroke="#ef4444" stroke-width="4" />
                                <rect x="218" y="30" width="4" height="20" fill="#ef4444" />
                                <line x1="260" y1="20" x2="260" y2="40" stroke="#4f46e5" stroke-width="4" />
                                <rect x="258" y="40" width="4" height="15" fill="#4f46e5" />
                                <line x1="300" y1="15" x2="300" y2="25" stroke="#4f46e5" stroke-width="4" />
                                <rect x="298" y="25" width="4" height="10" fill="#4f46e5" />
                                <line x1="340" y1="20" x2="340" y2="30" stroke="#ef4444" stroke-width="4" />
                                <rect x="338" y="10" width="4" height="10" fill="#ef4444" />
                                <line x1="380" y1="10" x2="380" y2="20" stroke="#4f46e5" stroke-width="4" />
                                <rect x="378" y="20" width="4" height="15" fill="#4f46e5" />
                            </g>
                            
                            <!-- Main trendline -->
                            <path class="animated-line" d="M 0,150 L 50,120 L 100,140 L 150,100 L 200,80 L 250,95 L 300,50 L 350,40 L 400,30" stroke="var(--primary)" stroke-width="2" fill="none" />
                            <!-- Moving average line -->
                            <path class="animated-line" d="M 0,140 L 50,130 L 100,120 L 150,110 L 200,90 L 250,80 L 300,70 L 350,60 L 400,50" stroke="#ef4444" stroke-width="2" stroke-dasharray="5,5" fill="none" />
                            <!-- X-axis -->
                            <line x1="0" y1="180" x2="400" y2="180" stroke="var(--border)" />
                            <!-- Y-axis -->
                            <line x1="0" y1="180" x2="0" y2="0" stroke="var(--border)" />
                        </svg>
                    </div>
                    
                    <div class="tab-selector">
                        <div class="tab-item active">RSI</div>
                        <div class="tab-item">MACD</div>
                        <div class="tab-item">Bollinger Bands</div>
                        <div class="tab-item">Moving Averages</div>
                        <div class="tab-item">Volume</div>
                    </div>
                    
                    <div class="placeholder-chart" style="height: 150px;">
                        <svg viewBox="0 0 400 100">
                            <!-- RSI indicator with animation -->
                            <path class="animated-line" d="M 0,50 L 50,40 L 100,30 L 150,20 L 200,10 L 250,20 L 300,30 L 350,40 L 400,50" stroke="#a855f7" stroke-width="2" fill="none" />
                            <!-- Overbought line -->
                            <line x1="0" y1="20" x2="400" y2="20" stroke="#ef4444" stroke-dasharray="3,3" />
                            <!-- Oversold line -->
                            <line x1="0" y1="80" x2="400" y2="80" stroke="#10b981" stroke-dasharray="3,3" />
                            <!-- X-axis -->
                            <line x1="0" y1="100" x2="400" y2="100" stroke="var(--border)" />
                            
                            <!-- Label texts -->
                            <text x="5" y="25" fill="#ef4444" font-size="10">Overbought (70)</text>
                            <text x="5" y="95" fill="#10b981" font-size="10">Oversold (30)</text>
                        </svg>
                    </div>
                    
                    <div class="analysis-explanation">
                        <div class="analysis-title">RSI Analysis</div>
                        <p>The Relative Strength Index (RSI) for AAPL is currently at 68.24, approaching overbought territory (70). This suggests that the stock has seen significant buying pressure in recent sessions and may be due for a short-term pullback or consolidation.</p>
                        <p>The RSI has been trending upward over the past two weeks, but has not yet crossed the critical 70 level which would indicate overbought conditions. Traders should monitor this indicator closely as a cross above 70 could signal potential weakness ahead.</p>
                    </div>
                    
                    <div class="analysis-explanation">
                        <div class="analysis-title">Overall Technical Outlook</div>
                        <p>AAPL is showing strong momentum on a technical basis, trading above both its 50-day and 200-day moving averages, which is typically bullish. The stock has formed a cup-and-handle pattern over the past 3 months which suggests further upside potential if it breaks above the $188 resistance level.</p>
                        <p>However, with the RSI approaching overbought levels and MACD showing potential divergence, caution is warranted in the short term. Support levels to watch include $180 and $175, while resistance sits at $188 and $195.</p>
                        <p>Volume has been increasing on up days, which confirms the bullish trend, but traders should be aware that earnings are approaching in 3 weeks, which could increase volatility.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Index Graph Modal -->
    <div id="index-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">S&P 500</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div id="candlestick-chart" style="height: 400px; width: 100%;"></div>
            
            <div class="tab-selector">
                <div class="tab-item" data-period="3M">3M</div>
                <div class="tab-item" data-period="6M">6M</div>
                <div class="tab-item" data-period="YTD">YTD</div>
                <div class="tab-item" data-period="1Y">1Y</div>
                <div class="tab-item" data-period="5Y">5Y</div>
                <div class="tab-item" data-period="Max">Max</div>
            </div>
            
            <!-- Rest of modal content -->
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Plotly === 'undefined') {
                console.error('Plotly is not loaded. Please check the CDN or network connection.');
                return;
            }
            
            // Tab navigation
            const tabLinks = document.querySelectorAll('.tab-link');
            tabLinks.forEach(link => {
                link.addEventListener('click', function() {
                    tabLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    const sections = document.querySelectorAll('.section');
                    sections.forEach(section => section.classList.remove('active'));
                    const targetSection = document.getElementById(this.getAttribute('data-tab'));
                    setTimeout(() => {
                        targetSection.classList.add('active');
                    }, 50);
                });
            });
            // Market tabs toggle functionality
            const marketTabs = document.querySelectorAll('.tab-selector[data-index="us"], .tab-selector[data-index="india"]');
            const usMarketData = document.getElementById('us-market-data');
            const indianMarketData = document.getElementById('indian-market-data');

            document.querySelectorAll('#movers-section .tab-selector .tab-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('#movers-section .tab-selector .tab-item').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Show the appropriate data based on the selected tab
                    const marketIndex = this.getAttribute('data-index');
                    if (marketIndex === 'us') {
                        usMarketData.style.display = 'block';
                        indianMarketData.style.display = 'none';
                    } else if (marketIndex === 'india') {
                        usMarketData.style.display = 'none';
                        indianMarketData.style.display = 'block';
                    }
                });
            });
        
            // Index card and period tab functionality
            const indexCards = document.querySelectorAll('.index-card');
            const indexModal = document.getElementById('index-modal');
            const modalClose = document.querySelector('.modal-close');
            const modalTitle = document.querySelector('.modal-title');
            const chartDiv = document.getElementById('candlestick-chart');
            const loadingOverlay = document.querySelector('.loading-overlay');
            const periodTabs = document.querySelectorAll('#index-modal .tab-item');
        
            const indexSymbols = {
                'S&P 500': '^GSPC',
                'Dow Jones': '^DJI',
                'Nasdaq': '^IXIC',
                'Russell 2000': '^RUT',
                'Nifty 50': '^NSEI',
                'Sensex': '^BSESN'
            };
        
            let currentSymbol = null; // Store the current symbol globally
        
            // Function to render the chart
            function renderChart(symbol, period) {
                loadingOverlay.classList.add('active');
                fetch(`/candlestick/${symbol}?period=${period}`)
                    .then(response => {
                        console.log('Fetch response received for period:', period);
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Data received:', data);
                        if (data.error) {
                            throw new Error(data.error);
                        }
        
                        loadingOverlay.classList.remove('active');
        
                        const trace = {
                            x: data.Date,
                            open: data.Open,
                            high: data.High,
                            low: data.Low,
                            close: data.Close,
                            type: 'candlestick',
                            increasing: {line: {color: '#10b981'}},
                            decreasing: {line: {color: '#ef4444'}}
                        };
        
                        const layout = {
                            title: `${modalTitle.textContent} Candlestick Chart (${period})`,
                            xaxis: {title: 'Date'},
                            yaxis: {title: 'Price'},
                            dragmode: 'zoom',
                            margin: {r: 10, t: 50, l: 60, b: 50},
                            plot_bgcolor: 'rgba(30, 41, 59, 0.9)',
                            paper_bgcolor: 'rgba(30, 41, 59, 0.9)',
                            font: {color: '#f3f4f6'},
                            showlegend: false
                        };
        
                        Plotly.newPlot(chartDiv, [trace], layout);
                    })
                    .catch(error => {
                        console.error('Error fetching candlestick data:', error);
                        loadingOverlay.classList.remove('active');
                        chartDiv.innerHTML = '<p style="color: #f3f4f6; text-align: center;">Error loading chart data: ' + error.message + '</p>';
                    });
            }
        
            // Index card click
            indexCards.forEach(card => {
                card.addEventListener('click', function() {
                    console.log('Index card clicked');
                    const indexName = this.querySelector('.index-name').textContent;
                    currentSymbol = indexSymbols[indexName];
                    modalTitle.textContent = indexName;
        
                    // Show modal
                    console.log('Showing modal');
                    indexModal.style.display = 'flex';
                    setTimeout(() => {
                        indexModal.classList.add('active');
                    }, 10);
        
                    // Reset period tabs and render default chart (1Y)
                    periodTabs.forEach(tab => tab.classList.remove('active'));
                    periodTabs[0].classList.add('active'); // Default to 1D
                    renderChart(currentSymbol, '1D');
                });
            });
        
            // Period tab click
            periodTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    console.log('Period tab clicked:', this.getAttribute('data-period'));
                    periodTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const period = this.getAttribute('data-period');
                    if (currentSymbol) {
                        renderChart(currentSymbol, period);
                    }
                });
            });
        
            // Close modal
            modalClose.addEventListener('click', function() {
                console.log('Closing modal');
                indexModal.classList.remove('active');
                setTimeout(() => {
                    indexModal.style.display = 'none';
                }, 400);
            });
        
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === indexModal) {
                    console.log('Clicked outside modal');
                    indexModal.classList.remove('active');
                    setTimeout(() => {
                        indexModal.style.display = 'none';
                    }, 400);
                }
            });
        
            // Search functionality
            const searchButton = document.getElementById('search-button');
            const searchInput = document.getElementById('stock-search');
            searchButton.addEventListener('click', function() {
                const ticker = searchInput.value.trim().toUpperCase();
                if (ticker) {
                    loadingOverlay.classList.add('active');
                    setTimeout(function() {
                        loadingOverlay.classList.remove('active');
                        document.querySelector('.tab-link[data-tab="stock-section"]').click();
                        document.getElementById('no-stock-selected').style.display = 'none';
                        document.getElementById('stock-content').style.display = 'block';
                        document.getElementById('no-stock-analysis').style.display = 'none';
                        document.getElementById('analysis-content').style.display = 'block';
                    }, 1500);
                }
            });
        
            searchInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    searchButton.click();
                }
            });
        
            // Tab selectors within sections
            const tabSelectors = document.querySelectorAll('.tab-selector');
            tabSelectors.forEach(selector => {
                const tabItems = selector.querySelectorAll('.tab-item');
                tabItems.forEach(item => {
                    item.addEventListener('click', function() {
                        tabItems.forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            });
        
            // Count animation
            const countElements = document.querySelectorAll('.count-animation');
            countElements.forEach(element => {
                const targetValue = parseFloat(element.textContent.replace(/[^0-9.-]+/g, ''));
                if (!isNaN(targetValue)) {
                    const prefix = element.textContent.startsWith('$') ? '$' : '';
                    const suffix = element.textContent.includes('%') ? '%' : '';
                    let startValue = targetValue * 0.7;
                    if (targetValue < 1) startValue = 0;
                    const duration = 1500;
                    const startTime = performance.now();
        
                    function updateCount(currentTime) {
                        const elapsedTime = currentTime - startTime;
                        const progress = Math.min(elapsedTime / duration, 1);
                        const easedProgress = 1 - Math.pow(1 - progress, 3);
                        const currentValue = startValue + (targetValue - startValue) * easedProgress;
                        let formatted;
                        if (element.textContent.includes(',')) {
                            formatted = prefix + currentValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + suffix;
                        } else if (element.textContent.includes('.')) {
                            const decimalPlaces = (element.textContent.split('.')[1] || '').length;
                            formatted = prefix + currentValue.toFixed(decimalPlaces) + suffix;
                        } else {
                            formatted = prefix + Math.round(currentValue).toLocaleString() + suffix;
                        }
                        element.textContent = formatted;
                        if (progress < 1) {
                            requestAnimationFrame(updateCount);
                        }
                    }
                    requestAnimationFrame(updateCount);
                }
            });
        
            // Update time
            function updateTime() {
                const now = new Date();
                const formattedTime = now.toLocaleString('en-US', {
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
                document.getElementById('last-updated').textContent = formattedTime;
            }
            updateTime();
            setInterval(updateTime, 60000);
        });
        </script>
</body>
</html>